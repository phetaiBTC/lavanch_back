{
    "sourceFile": "src/modules/branch/branch_expenses/branch-expense.controller.ts",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 1,
            "patches": [
                {
                    "date": 1761673126659,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1764856926712,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -9,18 +9,21 @@\n   UseGuards,\r\n } from '@nestjs/common';\r\n import { CreateBranchExpenseDto } from './dto/create-branch-expense.dto';\r\n import { ApproveExpenseDto } from './dto/approve-expense.dto';\r\n-import { PaginationDto } from 'src/shared/dto/pagination.dto';\r\n+import { FindBranchExpenseDto } from './dto/find-branch-expense.dto';\r\n import { CreateBranchExpenseUseCase } from './application/commands/create-branch-expense.usecase';\r\n import { ApproveExpenseUseCase } from './application/commands/approve-expense.usecase';\r\n import { FindOneBranchExpenseUseCase } from './application/queries/findOne-branch-expense.usecase';\r\n import { FindAllBranchExpenseUseCase } from './application/queries/find-branch-expense.usecase';\r\n+import { GetBranchExpenseSummaryUseCase } from './application/queries/get-summary.usecase';\r\n import { PaginatedResponse } from 'src/shared/interface/pagination.interface';\r\n import { BranchExpenseMapper } from './infrastructure/branch-expense.mapper';\r\n import { BranchExpenseResponse } from './interface/branch-expense.interface';\r\n import { JwtAuthGuard } from 'src/guards/AuthGuard';\r\n import { CurrentUser } from 'src/shared/decorator/user.decorator';\r\n+import { SummaryResponse } from './domain/branch-expense.repository';\r\n+import { AuthPayload } from 'src/modules/auth/interface/auth.interface';\r\n \r\n @Controller('branch-expenses')\r\n @UseGuards(JwtAuthGuard)\r\n export class BranchExpenseController {\r\n@@ -28,8 +31,9 @@\n     private readonly createBranchExpenseUseCase: CreateBranchExpenseUseCase,\r\n     private readonly approveExpenseUseCase: ApproveExpenseUseCase,\r\n     private readonly findOneBranchExpenseUseCase: FindOneBranchExpenseUseCase,\r\n     private readonly findAllBranchExpenseUseCase: FindAllBranchExpenseUseCase,\r\n+    private readonly getSummaryUseCase: GetBranchExpenseSummaryUseCase,\r\n   ) {}\r\n \r\n   /**\r\n    * Create a new expense (status: PENDING)\r\n@@ -37,9 +41,9 @@\n    */\r\n   @Post()\r\n   async create(\r\n     @Body() dto: CreateBranchExpenseDto,\r\n-    @CurrentUser() user: any,\r\n+    @CurrentUser() user: AuthPayload,\r\n   ): Promise<BranchExpenseResponse> {\r\n     return BranchExpenseMapper.toResponse(\r\n       await this.createBranchExpenseUseCase.execute(dto, user.id),\r\n     );\r\n@@ -49,16 +53,26 @@\n    * Get all expenses\r\n    */\r\n   @Get()\r\n   async findAll(\r\n-    @Query() query: PaginationDto,\r\n+    @Query() query: FindBranchExpenseDto,\r\n   ): Promise<PaginatedResponse<BranchExpenseResponse>> {\r\n     return BranchExpenseMapper.toResponseList(\r\n       await this.findAllBranchExpenseUseCase.execute(query),\r\n     );\r\n   }\r\n \r\n   /**\r\n+   * Get summary statistics (total amount, counts by status)\r\n+   */\r\n+  @Get('summary')\r\n+  async getSummary(\r\n+    @Query() query: FindBranchExpenseDto,\r\n+  ): Promise<SummaryResponse> {\r\n+    return this.getSummaryUseCase.execute(query);\r\n+  }\r\n+\r\n+  /**\r\n    * Get single expense by ID\r\n    */\r\n   @Get(':id')\r\n   async findOne(@Param('id') id: number): Promise<BranchExpenseResponse> {\r\n@@ -75,11 +89,28 @@\n   @Patch(':id/approve')\r\n   async approve(\r\n     @Param('id') id: number,\r\n     @Body() dto: ApproveExpenseDto,\r\n-    @CurrentUser() user: any,\r\n+    @CurrentUser() user: AuthPayload,\r\n   ): Promise<BranchExpenseResponse> {\r\n     return BranchExpenseMapper.toResponse(\r\n       await this.approveExpenseUseCase.execute(+id, dto, user.id),\r\n     );\r\n   }\r\n+\r\n+  /**\r\n+   * Reject an expense (convenience endpoint)\r\n+   */\r\n+  @Patch(':id/reject')\r\n+  async reject(\r\n+    @Param('id') id: number,\r\n+    @CurrentUser() user: any,\r\n+  ): Promise<BranchExpenseResponse> {\r\n+    return BranchExpenseMapper.toResponse(\r\n+      await this.approveExpenseUseCase.execute(\r\n+        +id,\r\n+        { action: 'REJECT' as any },\r\n+        user.id,\r\n+      ),\r\n+    );\r\n+  }\r\n }\r\n"
                }
            ],
            "date": 1761673126659,
            "name": "Commit-0",
            "content": "import {\r\n  Controller,\r\n  Get,\r\n  Post,\r\n  Body,\r\n  Param,\r\n  Patch,\r\n  Query,\r\n  UseGuards,\r\n} from '@nestjs/common';\r\nimport { CreateBranchExpenseDto } from './dto/create-branch-expense.dto';\r\nimport { ApproveExpenseDto } from './dto/approve-expense.dto';\r\nimport { PaginationDto } from 'src/shared/dto/pagination.dto';\r\nimport { CreateBranchExpenseUseCase } from './application/commands/create-branch-expense.usecase';\r\nimport { ApproveExpenseUseCase } from './application/commands/approve-expense.usecase';\r\nimport { FindOneBranchExpenseUseCase } from './application/queries/findOne-branch-expense.usecase';\r\nimport { FindAllBranchExpenseUseCase } from './application/queries/find-branch-expense.usecase';\r\nimport { PaginatedResponse } from 'src/shared/interface/pagination.interface';\r\nimport { BranchExpenseMapper } from './infrastructure/branch-expense.mapper';\r\nimport { BranchExpenseResponse } from './interface/branch-expense.interface';\r\nimport { JwtAuthGuard } from 'src/guards/AuthGuard';\r\nimport { CurrentUser } from 'src/shared/decorator/user.decorator';\r\n\r\n@Controller('branch-expenses')\r\n@UseGuards(JwtAuthGuard)\r\nexport class BranchExpenseController {\r\n  constructor(\r\n    private readonly createBranchExpenseUseCase: CreateBranchExpenseUseCase,\r\n    private readonly approveExpenseUseCase: ApproveExpenseUseCase,\r\n    private readonly findOneBranchExpenseUseCase: FindOneBranchExpenseUseCase,\r\n    private readonly findAllBranchExpenseUseCase: FindAllBranchExpenseUseCase,\r\n  ) {}\r\n\r\n  /**\r\n   * Create a new expense (status: PENDING)\r\n   * Does not affect wallet balance until approved\r\n   */\r\n  @Post()\r\n  async create(\r\n    @Body() dto: CreateBranchExpenseDto,\r\n    @CurrentUser() user: any,\r\n  ): Promise<BranchExpenseResponse> {\r\n    return BranchExpenseMapper.toResponse(\r\n      await this.createBranchExpenseUseCase.execute(dto, user.id),\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get all expenses\r\n   */\r\n  @Get()\r\n  async findAll(\r\n    @Query() query: PaginationDto,\r\n  ): Promise<PaginatedResponse<BranchExpenseResponse>> {\r\n    return BranchExpenseMapper.toResponseList(\r\n      await this.findAllBranchExpenseUseCase.execute(query),\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Get single expense by ID\r\n   */\r\n  @Get(':id')\r\n  async findOne(@Param('id') id: number): Promise<BranchExpenseResponse> {\r\n    return BranchExpenseMapper.toResponse(\r\n      await this.findOneBranchExpenseUseCase.execute(id),\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Approve or reject an expense\r\n   * When approved: Creates wallet transaction and deducts from branch balance\r\n   * When rejected: Just updates status\r\n   */\r\n  @Patch(':id/approve')\r\n  async approve(\r\n    @Param('id') id: number,\r\n    @Body() dto: ApproveExpenseDto,\r\n    @CurrentUser() user: any,\r\n  ): Promise<BranchExpenseResponse> {\r\n    return BranchExpenseMapper.toResponse(\r\n      await this.approveExpenseUseCase.execute(+id, dto, user.id),\r\n    );\r\n  }\r\n}\r\n"
        }
    ]
}